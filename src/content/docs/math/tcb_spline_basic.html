<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<title>tcb_spline_basic.html</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>

</head>

<body>

[WARNING] Could not convert TeX math '
  \left\{
  \begin{align*}
  P(0) &= P_i \\
  P(1) &= P_{i+1} \\
  P'(0) &= D_{i,i+1}^- \\
  P'(1) &= D_{i+1,i}^+
  \end{align*}
  \right.
  ', rendering as TeX
[WARNING] Could not convert TeX math '
  \left\{
  \begin{align*}
  a &=D_{i+1,i}^+ + D_{i,i+1}^- + 2( P_{i} -P_{i+1})\\
  b &=3(P_{i+1} - P_{i}) -2D_{i+1,i}^+ - D_{i,i+1}^-\\
  c &= D_{i,i+1}^-\\
  d &=P_{i}
  \end{align*}
  \right.
  ', rendering as TeX
[WARNING] Could not convert TeX math '
  \begin{align*}
  P(u) = &(2u^3 - 3u^2 + 1) \cdot P_{i}   + (u^3 - 2u^2 + u) \cdot D_{i,i+1}^-\\
         &+ (-2u^3 + 3u^2 ) \cdot P_{i+1} + (u^3 - u^2)      \cdot D_{i,i+1}^+\\
       = &h_{00} \cdot P_{i}   + h_{10} \cdot D_{i,i+1}^- + h_{01} \cdot P_{i+1} + h_{11} \cdot D_{i,i+1}^+\\
  \end{align*}
  ', rendering as TeX
[WARNING] Could not convert TeX math '
  \left\{
     \begin{align}
     h_{00}(u) &= 2u^3 - 3u^2 + 1 \\
     h_{10}(u) &= u^3 - 2u^2 + u \\
     h_{01}(u) &= -2u^3 + 3u^2 \\
     h_{11}(u) &= u^3 - u^2
     \end{align}
  \right.
     ', rendering as TeX
[WARNING] Could not convert TeX math '
  D_i = \alpha(P_{i+1} - P_{i-1})\\
  \left( \alpha = \frac{1}{||P_{i+1} - P_{i-1}||} \right)
  ', rendering as TeX:
  D_i = \alpha(P_{i+1} - P_{i-1})\\
  ^
  unexpected "\\"
  expecting "%", "\\label", "\\nonumber" or whitespace
[WARNING] Could not convert TeX math '
  \left\{
  \begin{align*}
  D_{i,i+1}^- &= w_1(P_i - P_{i-1}) + w_2(P_{i+1} - P_i) \\
  D_{i,i+1}^+ &= w_3(P_i - P_{i-1}) + w_4(P_{i+1} - P_i)
  \end{align*}
  \right.
  ', rendering as TeX
[WARNING] Could not convert TeX math '
  \left\{
  \begin{align*}
  w_1 &= \frac{(1-t)(1+b)(1+c)}{2} \\
  w_2 &= \frac{(1-t)(1-b)(1-c)}{2} \\
  w_3 &= \frac{(1-t)(1+b)(1-c)}{2} \\
  w_4 &= \frac{(1-t)(1-b)(1+c)}{2}
  \end{align*}
  \right.
  ', rendering as TeX
[WARNING] Could not convert TeX math '
  \left\{
  \begin{align*}
  D_{i,i+1}^- &= \frac{(1-t)(1+b)(1+c)}{2}(P_i - P_{i-1}) + \frac{(1-t)(1-b)(1-c)}{2}(P_{i+1} - P_i) \\
  D_{i,i+1}^+ &= \frac{(1-t)(1+b)(1-c)}{2}(P_i - P_{i-1}) + \frac{(1-t)(1-b)(1+c)}{2}(P_{i+1} - P_i)
  \end{align*}
  \right.
  ', rendering as TeX
[WARNING] Could not convert TeX math '
  \begin{align*}
  B(u) &= (1-u)^3B_0 + 3u(1-u)^2B_1 + 3u^2(1-u)B_2 + u^3B_3
  \end{align*}
  ', rendering as TeX
[WARNING] Could not convert TeX math '
     \begin{align*}
     P(u) &= h_{00}(u)P_i + h_{10}(u)D_{i,i+1}^- + h_{01}(u)P_{i+1} + h_{11}(u)D_{i+1,i}^+ \\
          &= (2u^3 - 3u^2 + 1)P_i + (u^3 - 2u^2 + u)D_{i,i+1}^- + (-2u^3 + 3u^2)P_{i+1} + (u^3 - u^2)D_{i+1,i}^+
     \end{align*}
     ', rendering as TeX
[WARNING] Could not convert TeX math '
     \begin{align*}
     B(u) &= (1-u)^3B_0 + 3u(1-u)^2B_1 + 3u^2(1-u)B_2 + u^3B_3
     \end{align*}
     ', rendering as TeX
[WARNING] Could not convert TeX math '
     \left\{
     \begin{align*}
       P(0) &= P_i\\
       P(1) &= P_{i+1}\\
      \end{align*}
  \right.
     \left\{
     \begin{align*}
       B(0) &= B_0\\
       B(1) &= B_3
      \end{align*}
  \right.
     ', rendering as TeX
[WARNING] Could not convert TeX math '
   \left\{
   \begin{equation}
    \begin{align*}
      B_0 &= P_i &\\
      B_3 &= P_{i+1}&
    \end{align*}
   \end{equation}  
   \right.
  ', rendering as TeX
[WARNING] Could not convert TeX math '
     \left\{
      \begin{align*}
        P'(u) &= 6( u^{2}-u)P_{0}+(3u^{2}-4u+1)D_{i,i+1}^{-}+6(-u^{2}+u)P_{i+1}+(3u^{2}-2u)D_{i+1,i}^{+}\\
        B'(u) &= 3(1-u)^2(B_1-B_0) + 6u(1-u)(B_2-B_1) + 3u^2(B_3-B_2)   
      \end{align*}
     \right.
     ', rendering as TeX
[WARNING] Could not convert TeX math '
   \left\{
    \begin{equation}
     \begin{align*}
       D_{i,i+1}^- &= 3(B_1-B_0) &\\
                   &= 3(B_1-P_i) &\\
       D_{i+1,i}^+ &= 3(B_3-B_2) &\\
                   &= 3(P_{i+1}-B_2)
     \end{align*}
    \end{equation}
   \right.   
  ', rendering as TeX
[WARNING] Could not convert TeX math '
   \left\{
    \begin{equation}
     \begin{align*}
      B_1 &= P_i + \frac{1}{3}D_{i,i+1}^- &\\
      B_2 &= P_{i+1} - \frac{1}{3}D_{i+1,i}^+ &
     \end{align*}
    \end{equation}
   \right.   
  ', rendering as TeX
[WARNING] Could not convert TeX math '
     \begin{align*}
     P(u) &= (1-u)^3P_i + 3u(1-u)^2(P_i + \frac{1}{3}D_{i,i+1}^-) + 3u^2(1-u)(P_{i+1} - \frac{1}{3}D_{i+1,i}^+) + u^3P_{i+1}
     \end{align*}
     ', rendering as TeX
[WARNING] Could not convert TeX math '
   \left\{
    \begin{equation}
     \begin{align*}
       B_i^1       &= P_i + \frac{1}{3}D_{i,i+1}^-  & \\
       B_{i+1}^{-1} &= P_{i+1} - \frac{1}{3}D_{i+1,i}^+
     \end{align*}
    \end{equation}
   \right.
  ', rendering as TeX
[WARNING] Could not convert TeX math '
  P_{i,i+1}(u) = (1-u)^3P_i + 3u(1-u)^2(P_i + \frac{1}{3}D_{i,i+1}^-) + 3u^2(1-u)(P_{i+1} - \frac{1}{3}D_{i+1,i}^+) + u^3P_{i+1}
  ', rendering as TeX
[WARNING] Could not convert TeX math '
  \begin{align*}
  B_0^{Bezier} &= P_i^{Hermite} \\
  B_1^{Bezier} &= P_i^{Hermite} + \frac{1}{3}D_i^{Hermite} \\
  B_2^{Bezier} &= P_{i+1}^{Hermite} - \frac{1}{3}D_{i+1}^{Hermite} \\
  B_3^{Bezier} &= P_{i+1}^{Hermite}
  \end{align*}
  ', rendering as TeX
[WARNING] Could not convert TeX math '\frac{1}{3}', rendering as TeX
[WARNING] Could not convert TeX math '\frac{1}{3}', rendering as TeX
[WARNING] Could not convert TeX math '\frac{1}{3}', rendering as TeX
<style>{`

.sl-markdown-content > main > hr:not(:where(.not-content *)) {
  border: none !important;
  border-bottom: 4px double white !important;
  margin-bottom: 14px;
}
 
.sl-markdown-content div.ec-line {
margin-top: 0 !important;
font-size:10px;
}
.sl-markdown-content{
 font-size:15px;
}

.sl-markdown-content p,table,div.expressive-code {
 padding:0em;
 margin-top: 0em !important;
 margin-left: 1em !important;
}

.sl-markdown-content p {
 text-indent: 1em;
}
.sl-markdown-content li p {
  text-indent: 0;
  margin-left:0 !important;
}

.sl-markdown-content ul,ol,li::marker {
 padding-left:2em;
 margin-top: 0em !important;
 margin-left: 1em !important;
}


.sl-markdown-content h3::before {
content: "> ";
} 
.sl-markdown-content h4::before {
content: ">> ";
} 
.sl-markdown-content h5::before {
content: ">>> ";
} 
.sl-markdown-content h6::before {
content: ">>>> ";
} 

h1,h2,h3,h4,h5,h6 {
 margin-top: 1em !important;

}

figure pre {
 margin-top: 0.4em !important;
}
.sl-markdown-content h1 {
 font-size:27px;
 text-decoration: underline;
 font-weight: bold
}

.sl-markdown-content h2 {
 font-size:26px;
 font-weight: normal;
 text-decoration: underline;
}

.sl-markdown-content h3 {
 font-size:24px;
 font-weight: normal;
 font-style: italic;
 text-decoration: underline;
}

.sl-markdown-content h4 {
 font-size:22px;
 font-weight: normal;
 font-style: italic; 
 text-decoration: underline;
 margin-top: 2px;
}
.sl-markdown-content h5 {
 font-size:18px;
 font-weight: bold;
 font-style: italic; 
 text-decoration: underline;
}
.sl-markdown-content h6 {
 font-size:15px;
 font-weight: bold;
 font-style: italic; 
 text-decoration: underline;
}

.sl-markdown-content th {
 font-size:13px;
}
.sl-markdown-content td {
 font-size:13px;
}
`}</style>
<p>import CodeTitle from ‘../../../components/CodeTitle’; import MermaidChart from ‘../../../components/MermaidChart.astro’; import TimeStamp from ‘../../../components/TimeStamp’; import Box from ‘../../../components/Box’; import RedBox from ‘../../../components/RedBox’; import {TwoColumn,Left,Right} from ‘../../../components/TwoColumn’;</p>
<p><TimeStamp fileUrl={import.meta.url} /></p>
<h5 id="todos">TODOs</h5>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
nothing</li>
<li><input type="checkbox" disabled="" />
定式化</li>
<li><input type="checkbox" disabled="" />
具体的な線の計算</li>
<li><input type="checkbox" disabled="" />
他のAIに書かせて線の違いを確認</li>
</ul>
<h2 id="要約">要約</h2>
<p>本レポートでは <br/></p>
<ul>
<li>最初にTCBスプラインの基礎となるエルミートスプライン補間の説明を行う</li>
<li>エルミート・スプライン補間が接線ベクトルを用いて定義することを示す</li>
<li>接線ベクトルを拡張するTCBの考え方を適用して再定義する</li>
<li>以上からTCBの定式化を行う</li>
<li></li>
<li>具体的なTCBパラメータをあてはめた例を示す <br/></li>
</ul>
<p>TCBスプラインの最も興味深い点は、一次微分が連続なエルミート・スプライン補間をベースに拡張しつつ、一次微分が不連続な曲線もカバーできるように拡張し、より多彩な曲線を扱うことができることである。 <br/></p>
<p>TCBスプラインは、発明者の名前を取って、Kochanek-Bartelsスプラインと呼ばれることもある。</p>
<h2 id="エルミート補間">エルミート補間</h2>
<p>エルミート補間は位置と接線（導関数）を指定して曲線を生成する手法でありTCBスプラインの基礎となる。</p>
<h3 id="補間の基本原理">補間の基本原理</h3>
<ul>
<li>エルミート補間では、2つの端点とその接線ベクトルから3次多項式曲線を構築する</li>
<li>高々3次の多項式である理由は以下の理由による
<ul>
<li>合計四つの条件式が成立すること（2点間の位置条件が2つの制約、2点での接線条件から2つの制約）</li>
<li>4つの係数から構成されるのは高々3次多項式であること</li>
</ul></li>
</ul>
<h3 id="次エルミート多項式の標準形式">3次エルミート多項式の標準形式</h3>
<p><span class="math inline"><em>u</em> ∈ [0, 1]</span>で定義される正規化された区間での高々3次の多項式P(u)が 曲線を補間するものであると仮定する。</p>
<p><br /><span class="math display"><em>P</em>(<em>u</em>) = <em>a</em><em>u</em><sup>3</sup> + <em>b</em><em>u</em><sup>2</sup> + <em>c</em><em>u</em> + <em>d</em></span><br /></p>
<p>合計四つの境界条件が与えられたものとして、 係数<span class="math inline"><em>a</em></span>, <span class="math inline"><em>b</em></span>, <span class="math inline"><em>c</em></span>, <span class="math inline"><em>d</em></span>の値を解く。</p>
<p>実際に値を代入すると下記のとおりである</p>
<p><br /><span class="math display">$$
\left\{
\begin{align*}
P(0) &amp;= P_i \\
P(1) &amp;= P_{i+1} \\
P'(0) &amp;= D_{i,i+1}^- \\
P'(1) &amp;= D_{i+1,i}^+
\end{align*}
\right.
$$</span><br /></p>
<h3 id="エルミート基底関数表現の根拠">エルミート基底関数表現の根拠</h3>
<p>エルミート基底関数表現は、補間問題を解くための自然な形式として導出される：</p>
<p>一般的な多項式表現から出発し、 <br /><span class="math display"><em>P</em>(<em>u</em>) = <em>a</em><em>u</em><sup>3</sup> + <em>b</em><em>u</em><sup>2</sup> + <em>c</em><em>u</em> + <em>d</em></span><br /></p>
<p>境界条件を適用すると、</p>
<p>$$ {  . $$</p>
<p>さらに<span class="math inline"><em>a</em>, <em>b</em>, <em>c</em>, <em>d</em></span>について解くと、 <br /><span class="math display">$$
\left\{
\begin{align*}
a &amp;=D_{i+1,i}^+ + D_{i,i+1}^- + 2( P_{i} -P_{i+1})\\
b &amp;=3(P_{i+1} - P_{i}) -2D_{i+1,i}^+ - D_{i,i+1}^-\\
c &amp;= D_{i,i+1}^-\\
d &amp;=P_{i}
\end{align*}
\right.
$$</span><br /></p>
<p>最初の式に代入し、$P_{i},P_{i+1},D_{i+1,i}^+ + D_{i,i+1}^- $についてまとめると、</p>
<p><br /><span class="math display">$$
\begin{align*}
P(u) = &amp;(2u^3 - 3u^2 + 1) \cdot P_{i}   + (u^3 - 2u^2 + u) \cdot D_{i,i+1}^-\\
       &amp;+ (-2u^3 + 3u^2 ) \cdot P_{i+1} + (u^3 - u^2)      \cdot D_{i,i+1}^+\\
     = &amp;h_{00} \cdot P_{i}   + h_{10} \cdot D_{i,i+1}^- + h_{01} \cdot P_{i+1} + h_{11} \cdot D_{i,i+1}^+\\
\end{align*}
$$</span><br /></p>
<p>ただし、</p>
<p><br /><span class="math display">$$
\left\{
   \begin{align}
   h_{00}(u) &amp;= 2u^3 - 3u^2 + 1 \\
   h_{10}(u) &amp;= u^3 - 2u^2 + u \\
   h_{01}(u) &amp;= -2u^3 + 3u^2 \\
   h_{11}(u) &amp;= u^3 - u^2
   \end{align}
\right.
   $$</span><br /></p>
<p>となる。 <br/> 検算をすると確かに、 <br/> - <span class="math inline"><em>u</em> = 0</span>のとき：<span class="math inline"><em>P</em>(0) = <em>P</em><sub><em>i</em></sub></span> - <span class="math inline"><em>u</em> = 1</span>のとき：<span class="math inline"><em>P</em>(1) = <em>P</em><sub><em>i</em> + 1</sub></span> - <span class="math inline"><em>u</em> = 0</span>での接線：<span class="math inline"><em>P</em>′(0) = <em>D</em><sub><em>i</em>, <em>i</em> + 1</sub><sup>−</sup></span>（出力接線） - <span class="math inline"><em>u</em> = 1</span>での接線：<span class="math inline"><em>P</em>′(1) = <em>D</em><sub><em>i</em> + 1, <em>i</em></sub><sup>+</sup></span>（入力接線）</p>
<p>となる。</p>
<h4 id="結論">結論</h4>
<p>以上より、各接線の値を求めることによりエルミートスプライン曲線による補間が成立することが分かった</p>
<h2 id="tcbスプラインにおける曲線方程式">TCBスプラインにおける曲線方程式</h2>
<p>エルミート補間をするときに接線ベクトルを用いた式を前章で導いた。</p>
<p><br/> ここでは、接線ベクトルの一般的な定義から順に拡張してゆき、 TCBスプライン曲線における接線ベクトルの考え方を導き TCBスプラインの定式化を行う。</p>
<h3 id="接線ベクトルの一般的定義">接線ベクトルの一般的定義</h3>
<p>一般的に2点間の傾きは隣接する制御点の差分に係数 <span class="math inline"><em>α</em></span> を乗じて定義できる。 <span class="math inline"><em>α</em></span>は制御点間の距離で正規化するとより傾きとして理解しやすい形式になるかもしれない。</p>
<p><br /><span class="math display">$$
D_i = \alpha(P_{i+1} - P_{i-1})\\
\left( \alpha = \frac{1}{||P_{i+1} - P_{i-1}||} \right)
$$</span><br /></p>
<p>ここでより柔軟な制御のため、接線計算にパラメータを導入するように拡張する</p>
<p><br /><span class="math display"><em>D</em><sub><em>i</em></sub> = <em>α</em>[(1 − <em>β</em>)(<em>P</em><sub><em>i</em> + 1</sub> − <em>P</em><sub><em>i</em></sub>) + <em>β</em>(<em>P</em><sub><em>i</em></sub> − <em>P</em><sub><em>i</em> − 1</sub>)]</span><br /></p>
<p>これにより、 - <span class="math inline"><em>α</em></span>は接線ベクトルの大きさを制御する係数とみなせる - <span class="math inline"><em>β</em></span>は前後の制御点の影響バランスを制御するようにみなせる <br/></p>
<p><span class="math inline"><em>β</em> = 0.5</span> の場合、前後の影響が均等で、中心差分法に相当すると考えられる。 <br/></p>
<p>次に、この2点間の傾きではなく、 3点<span class="math inline"><em>P</em><sub><em>i</em> − 1</sub>, <em>P</em><sub><em>i</em></sub>, <em>P</em><sub><em>i</em> + 1</sub></span>を考えたときの真ん中の点<span class="math inline"><em>P</em><sub><em>i</em></sub></span>の傾きを考える。</p>
<p><span class="math inline"><em>P</em><sub><em>i</em></sub></span>に置ける傾きは、<span class="math inline"><em>P</em><sub><em>i</em> − 1</sub></span>側の傾きと、<span class="math inline"><em>P</em><sub><em>i</em> + 1</sub></span>側の傾きを別に定義し 異なることを許した場合、<span class="math inline"><em>P</em><sub><em>i</em></sub></span>の一次微分が不連続であることを許容するように拡張する。 <br/></p>
<p>この二つの傾きを先ほど導いた傾きの一般系をさらに重みづけの<span class="math inline"><em>w</em><sub><em>i</em></sub></span>を用いて下記のように書き下す。</p>
<p><br /><span class="math display">$$
\left\{
\begin{align*}
D_{i,i+1}^- &amp;= w_1(P_i - P_{i-1}) + w_2(P_{i+1} - P_i) \\
D_{i,i+1}^+ &amp;= w_3(P_i - P_{i-1}) + w_4(P_{i+1} - P_i)
\end{align*}
\right.
$$</span><br /></p>
<p>この重みをt,c,bの3つのパラメータを用いて再定義する。</p>
<p><br /><span class="math display">$$
\left\{
\begin{align*}
w_1 &amp;= \frac{(1-t)(1+b)(1+c)}{2} \\
w_2 &amp;= \frac{(1-t)(1-b)(1-c)}{2} \\
w_3 &amp;= \frac{(1-t)(1+b)(1-c)}{2} \\
w_4 &amp;= \frac{(1-t)(1-b)(1+c)}{2}
\end{align*}
\right.
$$</span><br /></p>
<p>下記の式をtcbスプラインの点<span class="math inline"><em>P</em><sub><em>i</em></sub></span>における<span class="math inline"><em>P</em><sub><em>i</em> − 1</sub></span>側と<span class="math inline"><em>P</em><sub><em>i</em> + 1</sub></span>側の傾きとして定義できる</p>
<p><br /><span class="math display">$$
\left\{
\begin{align*}
D_{i,i+1}^- &amp;= \frac{(1-t)(1+b)(1+c)}{2}(P_i - P_{i-1}) + \frac{(1-t)(1-b)(1-c)}{2}(P_{i+1} - P_i) \\
D_{i,i+1}^+ &amp;= \frac{(1-t)(1+b)(1-c)}{2}(P_i - P_{i-1}) + \frac{(1-t)(1-b)(1+c)}{2}(P_{i+1} - P_i)
\end{align*}
\right.
$$</span><br /></p>
<p>ただし、<span class="math inline"> − 1 ≤ <em>t</em> ≤ 1,  − 1 ≤ <em>c</em> ≤ 1,  − 1 ≤ <em>b</em> ≤ 1</span> <br/></p>
<p>この3つのパラメータにより、直観的な曲線の変形が可能になる</p>
<ul>
<li>c はcontinuityであり、<span class="math inline"><em>c</em> = 0</span>の時に、<span class="math inline"><em>P</em><sub><em>i</em></sub></span>における左右の一次微分値が等しく連続である。<span class="math inline"><em>c</em> =  − 1, <em>c</em> = 1</span>の時に左右の微分値が非対称に近づいてゆく</li>
<li>t はtensionであり、<span class="math inline"><em>P</em><sub><em>i</em></sub></span>での直線性を表しており、<span class="math inline"><em>t</em> = 0</span>を標準値として、<span class="math inline"><em>t</em> = 1</span>の時に直線になり、<span class="math inline"><em>t</em> =  − 1</span>の時により曲線的になる</li>
<li>b はbiasであり、<span class="math inline"><em>P</em><sub><em>i</em> − 1</sub>, <em>P</em><sub><em>i</em> + 1</sub></span>のどちらの影響を受けた傾きを算出するかであり、<span class="math inline"><em>b</em> = 0</span>の時には均等な影響を受ける。</li>
</ul>
<h3 id="ベジェ曲線">ベジェ曲線</h3>
<ul>
<li><a href="http://localhost:4321/math/bezier/">ベジェ曲線</a>は制御点の加重和として表現される曲線</li>
<li>特に3次ベジェ曲線は4つの制御点 <span class="math inline"><em>B</em><sub>0</sub>, <em>B</em><sub>1</sub>, <em>B</em><sub>2</sub>, <em>B</em><sub>3</sub></span> を用いて定義される</li>
<li>３次のベジェ曲線はエルミートスプラインと同値である
<ul>
<li>同じ曲線を異なる方法でパラメータ化しているだけで、どちらも3次多項式で表される同じ曲線族を表現しています。</li>
</ul></li>
<li>３次ベジェ曲線はその多項式特性を利用して描画アルゴリズムを高速化できるため、OpenGL等で曲線描画として採用されている</li>
<li>また制御点による形状制御が直感的であるためUIとして優れた点もある。</li>
<li>エルミート曲線は端点と接線による制御が直感的である</li>
</ul>
<p><br /><span class="math display">$$
\begin{align*}
B(u) &amp;= (1-u)^3B_0 + 3u(1-u)^2B_1 + 3u^2(1-u)B_2 + u^3B_3
\end{align*}
$$</span><br /></p>
<h3 id="エルミート形式からベジェ形式への変換過程">エルミート形式からベジェ形式への変換過程</h3>
<p>エルミート形式からベジェ形式への変換を詳細に導出する。 <br/></p>
<p>エルミート形式は下記の通り <br /><span class="math display">$$
   \begin{align*}
   P(u) &amp;= h_{00}(u)P_i + h_{10}(u)D_{i,i+1}^- + h_{01}(u)P_{i+1} + h_{11}(u)D_{i+1,i}^+ \\
        &amp;= (2u^3 - 3u^2 + 1)P_i + (u^3 - 2u^2 + u)D_{i,i+1}^- + (-2u^3 + 3u^2)P_{i+1} + (u^3 - u^2)D_{i+1,i}^+
   \end{align*}
   $$</span><br /></p>
<p>一方、ベジェ形式は下記の通り <br /><span class="math display">$$
   \begin{align*}
   B(u) &amp;= (1-u)^3B_0 + 3u(1-u)^2B_1 + 3u^2(1-u)B_2 + u^3B_3
   \end{align*}
   $$</span><br /></p>
<p>両者が等価になるように係数を比較することを目的に端点の値を求めるとそれぞれ、</p>
<p><br /><span class="math display">$$
   \left\{
   \begin{align*}
     P(0) &amp;= P_i\\
     P(1) &amp;= P_{i+1}\\
    \end{align*}
\right.
   \left\{
   \begin{align*}
     B(0) &amp;= B_0\\
     B(1) &amp;= B_3
    \end{align*}
\right.
   $$</span><br /> これより、 <br /><span class="math display">$$
 \left\{
 \begin{equation}
  \begin{align*}
    B_0 &amp;= P_i &amp;\\
    B_3 &amp;= P_{i+1}&amp;
  \end{align*}
 \end{equation}  
 \right.
$$</span><br /></p>
<p><br/><br/> 同様に端点での一次微分の値を求めると、</p>
<p><br /><span class="math display">$$
   \left\{
    \begin{align*}
      P'(u) &amp;= 6( u^{2}-u)P_{0}+(3u^{2}-4u+1)D_{i,i+1}^{-}+6(-u^{2}+u)P_{i+1}+(3u^{2}-2u)D_{i+1,i}^{+}\\
      B'(u) &amp;= 3(1-u)^2(B_1-B_0) + 6u(1-u)(B_2-B_1) + 3u^2(B_3-B_2)   
    \end{align*}
   \right.
   $$</span><br /> $$ {  .</p>
<p>{  . $$</p>
<p>係数を比較し、先ほどの結果を利用すると、 <br /><span class="math display">$$
 \left\{
  \begin{equation}
   \begin{align*}
     D_{i,i+1}^- &amp;= 3(B_1-B_0) &amp;\\
                 &amp;= 3(B_1-P_i) &amp;\\
     D_{i+1,i}^+ &amp;= 3(B_3-B_2) &amp;\\
                 &amp;= 3(P_{i+1}-B_2)
   \end{align*}
  \end{equation}
 \right.   
$$</span><br /></p>
<p>これを<span class="math inline"><em>B</em><sub>1</sub>, <em>B</em><sub>2</sub></span>について解くと、</p>
<p><br /><span class="math display">$$
 \left\{
  \begin{equation}
   \begin{align*}
    B_1 &amp;= P_i + \frac{1}{3}D_{i,i+1}^- &amp;\\
    B_2 &amp;= P_{i+1} - \frac{1}{3}D_{i+1,i}^+ &amp;
   \end{align*}
  \end{equation}
 \right.   
$$</span><br /></p>
<p>よって、ベジェ形式は、エルミート形式の点や接線によって下記のように書き直すことができ、 <br /><span class="math display">$$
   \begin{align*}
   P(u) &amp;= (1-u)^3P_i + 3u(1-u)^2(P_i + \frac{1}{3}D_{i,i+1}^-) + 3u^2(1-u)(P_{i+1} - \frac{1}{3}D_{i+1,i}^+) + u^3P_{i+1}
   \end{align*}
   $$</span><br /></p>
<p>この式の中間制御点は、元の点と接線ベクトルから計算されることが分かる。</p>
<p><br /><span class="math display">$$
 \left\{
  \begin{equation}
   \begin{align*}
     B_i^1       &amp;= P_i + \frac{1}{3}D_{i,i+1}^-  &amp; \\
     B_{i+1}^{-1} &amp;= P_{i+1} - \frac{1}{3}D_{i+1,i}^+
   \end{align*}
  \end{equation}
 \right.
$$</span><br /></p>
<h3 id="最終的な曲線方程式の導出">最終的な曲線方程式の導出</h3>
<p>TCB接線ベクトル<span class="math inline"><em>D</em><sub><em>i</em>, <em>i</em> + 1</sub><sup>−</sup></span>と<span class="math inline"><em>D</em><sub><em>i</em> + 1, <em>i</em></sub><sup>+</sup></span>を用いて、<span class="math inline"><em>P</em><sub><em>i</em></sub></span>と<span class="math inline"><em>P</em><sub><em>i</em> + 1</sub></span>の間のセグメントの曲線方程式は：</p>
<p><br /><span class="math display">$$
P_{i,i+1}(u) = (1-u)^3P_i + 3u(1-u)^2(P_i + \frac{1}{3}D_{i,i+1}^-) + 3u^2(1-u)(P_{i+1} - \frac{1}{3}D_{i+1,i}^+) + u^3P_{i+1}
$$</span><br /></p>
<p>これがTCBスプラインレポートで使用されている最終的な曲線方程式である。</p>
<h2 id="エルミート形式とベジェ形式の関係">エルミート形式とベジェ形式の関係</h2>
<h3 id="ベジェ曲線の幾何学的特性">ベジェ曲線の幾何学的特性</h3>
<p>ベジェ曲線は以下の重要な特性を持つ：</p>
<ul>
<li>端点補間：曲線は最初と最後の制御点を通過する</li>
<li>凸包性：曲線は制御点の凸包内に収まる</li>
<li>変換不変性：アフィン変換を制御点に適用すると、曲線全体に同じ変換が適用される</li>
<li>制御点の幾何学的影響：
<ul>
<li>端点 <span class="math inline"><em>B</em><sub>0</sub></span>, <span class="math inline"><em>B</em><sub>3</sub></span> は曲線が通過する点</li>
<li>制御点 <span class="math inline"><em>B</em><sub>1</sub></span> は <span class="math inline"><em>B</em><sub>0</sub></span> から出る接線方向を決定</li>
<li>制御点 <span class="math inline"><em>B</em><sub>2</sub></span> は <span class="math inline"><em>B</em><sub>3</sub></span> に入る接線方向を決定</li>
</ul></li>
</ul>
<h3 id="エルミート形式とベジェ形式の比較">エルミート形式とベジェ形式の比較</h3>
<p>エルミート補間とベジェ表現は数学的に等価であり、変換が可能：</p>
<ul>
<li>エルミート形式の特徴
<ul>
<li>2つの端点と2つの接線ベクトルで定義</li>
<li>曲線の形状が直感的に理解しやすい</li>
<li>アニメーションや物理シミュレーションでの速度・加速度の指定に適している</li>
</ul></li>
<li>ベジェ形式の特徴
<ul>
<li>4つの制御点で定義</li>
<li>コンピュータグラフィックスでの標準的な表現</li>
<li>分割と結合操作が容易</li>
<li>多くのグラフィックスライブラリやフォーマットでサポートされている</li>
</ul></li>
</ul>
<h3 id="変換式と導出">変換式と導出</h3>
<p>エルミート形式からベジェ形式への変換は、前節で導出した通り：</p>
<p><br /><span class="math display">$$
\begin{align*}
B_0^{Bezier} &amp;= P_i^{Hermite} \\
B_1^{Bezier} &amp;= P_i^{Hermite} + \frac{1}{3}D_i^{Hermite} \\
B_2^{Bezier} &amp;= P_{i+1}^{Hermite} - \frac{1}{3}D_{i+1}^{Hermite} \\
B_3^{Bezier} &amp;= P_{i+1}^{Hermite}
\end{align*}
$$</span><br /></p>
<p>重要なのは、<span class="math inline">$\frac{1}{3}$</span> の係数が微分条件から直接導出されることである。これはベジェ曲線の特性に基づいており、曲線の端点での接線が端点と隣接制御点を結ぶベクトルに平行で、その大きさが3倍になっていることを表している。</p>
<h2 id="tcbスプラインの実装上の考慮点">TCBスプラインの実装上の考慮点</h2>
<h3 id="計算効率">計算効率</h3>
<ul>
<li>ベジェ形式は複数の曲線セグメントを結合する際に効率的</li>
<li>TCB計算は各制御点ごとに1回だけ行い、結果をキャッシュ可能</li>
</ul>
<h3 id="幾何学的解釈">幾何学的解釈</h3>
<ul>
<li>接線ベクトルの長さを<span class="math inline">$\frac{1}{3}$</span>倍するのは、ベジェ制御点が曲線の<span class="math inline">$\frac{1}{3}$</span>の距離に配置されるため</li>
<li>この係数はベジェ曲線の性質から導出され、曲線の滑らかさを保証する</li>
</ul>
<h3 id="特別なケース">特別なケース</h3>
<ul>
<li>Catmull-RomスプラインはTCBスプラインの特殊ケース（t=c=b=0）</li>
<li>Uniformパラメータ化は等間隔のパラメータ値を使用</li>
<li>Centripetalパラメータ化は弧長の平方根に比例したパラメータ値を使用</li>
</ul>
<h2 id="用語説明">用語説明</h2>
<ul>
<li>エルミート補間：位置と導関数を境界条件として使用する補間法</li>
<li>基底関数：曲線を表現するための標準的な多項式関数のセット</li>
<li>ベジェ曲線：制御点の加重和として表現される滑らかな曲線で、バーンスタイン多項式を重み関数として使用</li>
<li>バーンスタイン多項式：ベジェ曲線の基本となる多項式で、二項係数と累乗の積として表現される</li>
<li>凸包：集合に含まれる点を全て含む最小の凸集合</li>
<li>パラメータ空間：曲線上の点を特定するためのパラメータの範囲[0,1]</li>
<li>接線ベクトル：曲線の各点における接線の方向と大きさを示すベクトル</li>
<li>アフィン変換：平行移動、回転、拡大縮小、せん断などの線形変換と平行移動の組み合わせ</li>
<li><strong>立方エルミートスプライン</strong>: 3次多項式と接線ベクトルを使用した補間手法</li>
<li><strong>Kochanek-Bartelsスプライン</strong>: テンション、バイアス、連続性のパラメータを導入した拡張カトマル-ロムスプライン</li>
<li><strong>カトマル-ロムスプライン</strong>: 制御点を通過する補間スプライン</li>
</ul>
<h2 id="リファレンス">リファレンス</h2>
<ul>
<li><p><a href="https://www.cs.cmu.edu/~fp/courses/graphics/asst5/catmullRom.pdf">Kochanek-Bartels スプライン原論文</a></p></li>
<li><p><a href="https://dl.acm.org/doi/10.1145/325334.325242">Interpolating Splines with Local Tension, Continuity, and Bias Control</a></p></li>
<li><p><a href="https://en.wikipedia.org/wiki/Cubic_Hermite_spline">エルミート曲線とベジェ曲線の関係</a></p></li>
<li><p><a href="https://pomax.github.io/bezierinfo/">ベジェ曲線の数学的特性</a></p></li>
<li><p><a href="https://www.sciencedirect.com/topics/mathematics/cubic-spline-interpolation">スプライン補間の数学的基礎</a></p></li>
<li><p>Kochanek, D. H. U., &amp; Bartels, R. H. (1984). Interpolating splines with local tension, continuity, and bias control. ACM SIGGRAPH Computer Graphics, 18(3), 33-41. https://dl.acm.org/doi/10.1145/964965.808575</p></li>
<li><p>Bartels, R. H., Beatty, J. C., &amp; Barsky, B. A. (1987). An introduction to splines for use in computer graphics and geometric modeling. Morgan Kaufmann.</p></li>
<li><p>Foley, J. D., van Dam, A., Feiner, S. K., &amp; Hughes, J. F. (1995). Computer Graphics: Principles and Practice. Addison-Wesley.</p></li>
</ul>

</body>
</html>
